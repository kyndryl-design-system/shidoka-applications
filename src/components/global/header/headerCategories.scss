@use '../../../common/scss/global.scss';

// Layout configuration
$column-gap: 32px;
$row-gap: 16px;
$min-column-width: 150px;
$max-column-width: 400px;

// Fixed column widths per column count (defaults for CSS custom properties)
$column-width-1: 350px;
$column-width-2: 300px;

:host {
  display: block;
  box-sizing: border-box;
  width: 100%;

  --kyn-header-category-column-width: #{$column-width-2};
  --kyn-header-category-column-gap: #{$column-gap};
}

.header-categories {
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;

  &__inner {
    display: block;
    column-gap: 32px;
    max-width: 100%;
    box-sizing: border-box;
  }

  &__back-slot {
    display: block;
    margin-top: 16px;
  }
}

.header-categories__inner > * {
  break-inside: avoid;
  -webkit-column-break-inside: avoid;
  page-break-inside: avoid;
  margin: 0 0 $row-gap;
}

slot.header-categories__slot::slotted(*) {
  display: block;
  break-inside: avoid;
  -webkit-column-break-inside: avoid;
  page-break-inside: avoid;
  margin: 0 0 $row-gap;
}

// Negate trailing margin (grid uses gap instead)
:host(:not([layout='grid']):not([view='detail'])) .header-categories__inner {
  margin-bottom: -$row-gap;
}

/* ---------------------------------------------------------------------
   LEGACY LAYOUT (no layout attribute â€” standard mega-nav)
   Preserves the original responsive column-width behavior.
   ------------------------------------------------------------------ */
@media (min-width: 672px) {
  :host(:not([layout]):not([view='detail'])),
  :host([layout='']:not([view='detail'])) {
    padding-right: 10%;
    width: calc(100vw - 230px);
    max-width: calc(100vw - 230px);
  }
}

:host(:not([layout]):not([view='detail'])) .header-categories__inner,
:host([layout='']:not([view='detail'])) .header-categories__inner {
  column-width: 160px;
}

@media (min-width: 896px) {
  :host(:not([layout]):not([view='detail'])) .header-categories__inner,
  :host([layout='']:not([view='detail'])) .header-categories__inner {
    column-width: 180px;
  }
}

@media (min-width: 1152px) {
  :host(:not([layout]):not([view='detail'])) .header-categories__inner,
  :host([layout='']:not([view='detail'])) .header-categories__inner {
    column-width: 200px;
  }
}

/* ---------------------------------------------------------------------
   MASONRY LAYOUT (categorical nav)
   ------------------------------------------------------------------ */
:host([layout='masonry']) {
  width: 100%;
  min-width: $min-column-width;
  max-width: 100%;
}

@media (min-width: 672px) {
  :host([layout='masonry']) {
    padding-right: 16px;
  }
}

:host([layout='masonry']) .header-categories__inner {
  column-width: auto;
  column-gap: var(--kyn-header-category-column-gap);

  // Tighter heading spacing for dense categorical layouts
  --kyn-header-category-heading-pb: 0;
  // Flush dividers for column layouts
  --kyn-header-divider-margin: 0;
  // Position dividers absolutely so they don't affect column balancing
  --kyn-header-divider-position: absolute;
  --kyn-header-divider-bottom: -9px;
  --kyn-header-divider-left: 0;
  --kyn-header-divider-right: 0;
}

// Column count driven by data-columns attribute
:host([layout='masonry'][data-columns='1']) .header-categories__inner {
  column-count: 1;
}
:host([layout='masonry'][data-columns='2']) {
  width: auto;
  max-width: calc(
    2 * var(--kyn-header-category-column-width) +
      var(--kyn-header-category-column-gap)
  );
}
:host([layout='masonry'][data-columns='2']) .header-categories__inner {
  column-count: 2;
}
@for $i from 3 through 10 {
  :host([layout='masonry'][data-columns='#{$i}']) .header-categories__inner {
    column-count: $i;
  }
}

/* --- GRID LAYOUT --- */
:host([layout='grid']) {
  width: max-content;
  min-width: $min-column-width;
  max-width: 100%;
}

@media (min-width: 672px) {
  :host([layout='grid']) {
    padding-right: 16px;
  }
}

:host([layout='grid']) .header-categories__inner {
  display: grid;
  gap: $row-gap var(--kyn-header-category-column-gap, $column-gap);
  grid-template-columns: minmax($min-column-width, $max-column-width);

  // Tighter heading spacing for dense categorical layouts
  --kyn-header-category-heading-pb: 0;
  // Flush dividers for grid layouts
  --kyn-header-divider-margin: 0;
}

// 1-2 columns use fixed widths; 3+ use 1fr to avoid overflow
:host([layout='grid'][data-columns='1']) .header-categories__inner {
  grid-template-columns: var(--kyn-header-category-column-width);
}
:host([layout='grid'][data-columns='2']) .header-categories__inner {
  grid-template-columns: repeat(2, var(--kyn-header-category-column-width));
}
@for $i from 3 through 10 {
  :host([layout='grid'][data-columns='#{$i}']) .header-categories__inner {
    grid-template-columns: repeat($i, 1fr);
  }
}

// Reset masonry-specific styles for grid items
:host([layout='grid']) .header-categories__inner > * {
  break-inside: auto;
  -webkit-column-break-inside: auto;
  page-break-inside: auto;
  margin: 0;
  min-width: 0;
}

/* ---------------------------------------------------------------------
   DETAIL VIEW
   ------------------------------------------------------------------ */

:host([view='detail']) {
  overflow-x: auto;
  overflow-y: hidden;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  &::-webkit-scrollbar {
    display: none;
  }
  .header-categories {
    &__inner {
      overflow: visible;
    }
  }
}

:host([view='detail']) .header-detail-columns {
  display: flex;
  align-items: flex-start;
  gap: 0 $column-gap;
  width: max-content;
  box-sizing: border-box;
}

:host([view='detail']) .header-detail-columns > div {
  display: flex;
  flex-direction: column;
  gap: 8px;
  flex: 0 0 200px;
}

:host([view='detail']) .header-detail-columns--single {
  max-width: 360px;
  width: auto;
}

:host([view='detail']) .header-detail-columns kyn-header-link {
  width: 100%;
  min-width: 0;
}

@media (min-width: 42rem) {
  :host([view='detail']) .header-detail-columns > div {
    min-width: 160px;
  }
}
